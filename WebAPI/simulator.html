<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Elevator Simulator</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 0 10px rgba(0,0,0,0.1);
        }


        .container {
            display: flex;
            justify-content: space-between; /* Spreads elements, control-panel in the middle */
            align-items: center; /* Vertically centers elements */
            width: 100%;
            max-width: 1200px; /* Adjust as needed */
            margin: 0 auto; /* Center container horizontally */
        }

        .control-panel {
            background-color: #eee;
            padding: 15px;
            border-radius: 5px;
            flex: 0 1 auto; /* Take natural width */
            text-align: center; /* Center buttons inside */
        }

        .floor-buttons, .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .element1, .element2 {
            flex: 1; /* Take equal space on either side */
            text-align: center; /* Optional: center content */
            padding: 20px;
            background-color: #f9f9f9; /* Optional: visual distinction */
        }

        .floor-btn, .control-btn {
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            border: none;
            border-radius: 3px;
        }

            .floor-btn:hover, .control-btn:hover {
                background-color: #ddd;
            }

        h1 {
            text-align: center;
            color: #333;
        }

        .layout {
            display: flex;
            gap: 20px;
            margin-top: 30px;
        }

        .left-panel {
            flex: 1;
        }

        .building {
            width: 300px;
            height: 900px;
            background-color: #ddd;
            position: relative;
            border: 2px solid #999;
            margin-bottom: 20px;
        }

        .floor {
            height: 100px;
            border-bottom: 2px solid #999;
            position: relative;
            display: flex;
            align-items: center;
            padding-left: 10px;
            box-sizing: border-box;
        }

        .between-floors {
            height: 50px;
            border-bottom: 1px dashed #999;
            position: relative;
        }

        .floor-label {
            font-weight: bold;
            width: 60px;
        }

        .door {
            width: 80px;
            height: 90px;
            background-color: #8B4513; /* Brown for closed door */
            position: absolute;
            right: 50px;
            top: 0px;
            transition: background-color 0.3s;
        }

            .door.open {
                background-color: #CD853F; /* Lighter brown for open door */
            }

        .elevator {
            width: 100px;
            height: 100px;
            background-color: #555;
            position: absolute;
            right: 40px;
            bottom: 0;
            transition: bottom 2s ease-in-out;
        }

        .elevator-door {
            width: 80px;
            height: 100px;
            background-color: #666;
            margin: 0 auto;
            transition: background-color 0.3s;
        }

            .elevator-door.open {
                background-color: #888;
            }

        .control-panel {
            background-color: #eee;
            padding: 15px;
            border-radius: 5px;
            margin-top: 20px;
            position:center;        }

        .floor-buttons, .control-buttons {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
            position:center;
        }

        button {
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
        }

        .floor-btn {
            background-color: #4CAF50;
            color: white;
        }

            .floor-btn:hover {
                background-color: #45a049;
            }

        .control-btn {
            color: white;
        }

        .start {
            background-color: #2196F3;
        }

        .stop {
            background-color: #f44336;
        }

        .continue {
            background-color: #ff9800;
        }

        .events-box {
            flex: 1;
            background-color: #eee;
            padding: 15px;
            border-radius: 5px;
            height: 400px;
            overflow-y: auto;
        }

        #events {
            list-style-type: none;
            padding: 0;
        }

            #events li {
                padding: 8px;
                background-color: white;
                margin-bottom: 5px;
                border-radius: 4px;
            }

        #reloadButton {
            background-color: #607d8b;
            color: white;
            margin-bottom: 10px;
        }
        .elevator.floor0 {
            bottom: 0;
        }

        .elevator.between10 {
            bottom: 75px;
        }

        .elevator.floor1 {
            bottom: 150px;
        }

        .elevator.between21 {
            bottom: 225px;
        }

        .elevator.floor2 {
            bottom: 300px;
        }

        .elevator.between32 {
            bottom: 375px;
        }

        .elevator.floor3 {
            bottom: 450px;
        }

        .elevator.between43 {
            bottom: 525px;
        }

        .elevator.floor4 {
            bottom: 600px;
        }

    </style>
</head>
<body>
    <h1>Elevator Simulator</h1>
    <div class="container">



        <!-- Control buttons -->
        <div class="container">

            <div class="element1">
                <div class="layout">
                    <!-- Left panel with elevator -->
                    <div class="left-panel">
                        <div class="building">
                            <!-- Floors and between-floors -->
                            <div class="floor floor4">
                                <div class="floor-label">Floor 4</div>
                                <div class="door" id="door4"></div>
                            </div>
                            <div class="floor floor3">
                                <div class="floor-label">4-3</div>
                                <div class="door" id="between43"></div>
                            </div>


                            <div class="floor floor3">
                                <div class="floor-label">Floor 3</div>
                                <div class="door" id="door3"></div>
                            </div>

                            <div class="floor floor3">
                                <div class="floor-label"> 3-2</div>
                                <div class="door" id="between32"></div>
                            </div>



                            <div class="floor floor2">
                                <div class="floor-label">Floor 2</div>
                                <div class="door" id="door2"></div>
                            </div>

                            <div class="floor floor3">
                                <div class="floor-label"> 2-1</div>
                                <div class="door" id="between21"></div>
                            </div>


                            <div class="floor floor1">
                                <div class="floor-label">Floor 1</div>
                                <div class="door" id="door1"></div>
                            </div>

                            <div class="floor floor3">
                                <div class="floor-label">1-0</div>
                                <div class="door" id="between10"></div>
                            </div>


                            <div class="floor floor0">
                                <div class="floor-label">Ground Floor</div>
                                <div class="door" id="door0"></div>
                            </div>

                            <!-- Elevator -->
                            <div class="elevator" id="elevator">
                                <div class="elevator-door"></div>
                            </div>
                        </div>
                    </div>
                    <div class="control-panel">
                        <div class="floor-buttons">
                            <button onclick="sendCommand('Floor4')" class="floor-btn">Floor 4</button>
                            <button onclick="sendCommand('Floor3')" class="floor-btn">Floor 3</button>
                            <button onclick="sendCommand('Floor2')" class="floor-btn">Floor 2</button>
                            <button onclick="sendCommand('Floor1')" class="floor-btn">Floor 1</button>
                            <button onclick="sendCommand('GroundFloor')" class="floor-btn">Ground Floor</button>
                        </div>
                        <div class="control-buttons">
                            <button onclick="sendCommand('Start')" class="control-btn start">Start</button>
                            <button onclick="sendCommand('Stop')" class="control-btn stop">Stop</button>
                            <button onclick="sendCommand('Continue')" class="control-btn continue">Continue</button>
                        </div>
                    </div>
                    <div class="element2">
                        <div>
                            <h2>Received Events</h2>
                            <button onclick="toggleAutoReload()" id="reloadButton">Stop Auto Reload</button>
                            <div class="events-box">
                                <ul id="events"></ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right panel with events -->


        <script>
            const apiUrl = "http://localhost:49570/api/simulator";
            let autoReloadInterval;
            let isAutoReloadEnabled = true;

            document.getElementById('sendForm').onsubmit = async function (e) {
                e.preventDefault();
                const state = document.getElementById('state').value;

                const dateInput = document.getElementById('date').value;
                const data = {
                    state: state,
                    stateChangedDate: new Date(dateInput).toISOString()
                };
                await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                loadEvents();
            };

            async function loadEvents() {
                const res = await fetch(apiUrl);
                const events = await res.json();
                const list = document.getElementById('events');
                list.innerHTML = '';

                // Definim un obiect care mapează valorile numerice la numele stărilor
                const stateNames = {
                    0: "GoingUp",
                    1: "GoingDown",
                    2: "GroundFloor",
                    3: "Floor1",
                    4: "Floor2",
                    5: "Floor3",
                    6: "Floor4",
                    7: "Stopped",
                    8: "Running",
                    9: "Wait"
                };

                events.forEach(ev => {
                    const li = document.createElement('li');
                    const stateName = stateNames[ev.state]; // Obține numele stării
                    li.textContent = `${stateName}`;
                    list.appendChild(li);
                });
                if (events.length > 0) {
                    const lastEvent = events[events.length - 1];
                    const lastState = stateNames[lastEvent.state];
                    setElevatorPosition(lastState);
                }
            }

            function toggleAutoReload() {
                const button = document.getElementById('reloadButton');
                if (isAutoReloadEnabled) {
                    clearInterval(autoReloadInterval);
                    button.textContent = "Pornește reîncărcarea automată";
                    isAutoReloadEnabled = false;
                } else {
                    startAutoReload();
                    button.textContent = "Oprește reîncărcarea automată";
                    isAutoReloadEnabled = true;
                }
            }

            function startAutoReload() {
                loadEvents(); // Încarcă imediat
                autoReloadInterval = setInterval(loadEvents, 1000); // Reîncarcă la fiecare secundă
            }

            // Pornește reîncărcarea automată la încărcarea paginii
            startAutoReload();





            //aici vreau sa fac delasarea liftului
            function setElevatorPosition(state) {
                let currentFloorClass = 'floor0'
                const elevator = document.getElementById('elevator');
                const elevatorDoor = elevator.querySelector('.elevator-door');
                // Șterge toate clasele de poziție
                elevator.classList.remove(
                    'floor0', 'floor1', 'floor2', 'floor3', 'floor4',
                    'between10', 'between21', 'between32', 'between43'
                );

                // Poziționează liftul în funcție de stare
                switch (state) {
                    case 'GroundFloor':
                        currentFloorClass = 'floor0'
                        elevator.classList.add('floor0');
                        elevatorDoor.classList.add('open');
                        break;
                    case 'Floor1':
                        currentFloorClass = 'floor0'
                        elevator.classList.add('floor1');
                        elevatorDoor.classList.add('open');
                        break;
                    case 'Floor2':
                        currentFloorClass = 'floor2'
                        elevator.classList.add('floor2');
                        break;
                    case 'Floor3':
                        currentFloorClass = 'floor3'
                        elevator.classList.add('floor3');
                        break;
                    case 'Floor4':
                        currentFloorClass = 'floor4'
                        elevator.classList.add('floor4');
                        break;
                    case 'GoingUp':
                        // Exemplu: între etajul curent și următorul (poți ajusta logica după nevoie)
                        elevator.classList.add('between21');
                        break;
                    case 'GoingDown':
                        // Exemplu: între etajul curent și precedentul (poți ajusta logica după nevoie)
                        elevator.classList.add('between32');
                        break;
                }

                // Ușa liftului: deschisă doar când e pe un etaj
                if (state.startsWith('Floor') || state === 'GroundFloor') {
                    elevatorDoor.classList.add('open');
                } else {
                    elevatorDoor.classList.remove('open');
                }
            }

        </script>
</body>
</html>