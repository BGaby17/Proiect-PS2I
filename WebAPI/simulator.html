<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Elevator Simulator</title>
    <link rel="stylesheet" href="style.css"> 
</head>
<body>
    <h1>Elevator Simulator</h1>

   

    <div class="container">

        <div class="container" >
            <table id="elevatorTable" border="1">
                <thead>
                    <tr>
                        <th>Etaj</th>
                        <th>Status</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Parter și etaje intermediare -->
                    <tr><td>Etaj 4</td><td><div class="circle"></div></td></tr>
                    <tr><td>Între 3 și 4</td><td><div class="circle"></div></td></tr>
                    <tr><td>Etaj 3</td><td><div class="circle"></div></td></tr>
                    <tr><td>Între 2 și 3</td><td><div class="circle"></div></td></tr>
                    <tr><td>Etaj 2</td><td><div class="circle"></div></td></tr>
                    <tr><td>Între 1 și 2</td><td><div class="circle"></div></td></tr>
                    <tr><td>Etaj 1</td><td><div class="circle"></div></td></tr>
                    <tr><td>Între P și 1</td><td><div class="circle"></div></td></tr>
                    <tr><td>Parter</td><td><div class="circle"></div></td></tr>
                </tbody>
            </table>
        </div>

        <h2>Received Events</h2>
        <button onclick="toggleAutoReload()" id="reloadButton">Stop Auto Reload</button>
        <div class="events-box">
            <ul id="events"></ul>
        </div>
    </div>




    <script>
        const apiUrl = "http://localhost:49570/api/simulator";
        let autoReloadInterval;
        let isAutoReloadEnabled = true;

        document.getElementById('sendForm').onsubmit = async function (e) {
            e.preventDefault();
            const state = document.getElementById('state').value;

            const dateInput = document.getElementById('date').value;
            const data = {
                state: state,
                stateChangedDate: new Date(dateInput).toISOString()
            };
            await fetch(apiUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });
            loadEvents();
        };

        async function loadEvents() {
            const res = await fetch(apiUrl);
            const events = await res.json();
            const list = document.getElementById('events');
            list.innerHTML = '';

            // Definim un obiect care mapează valorile numerice la numele stărilor
            const stateNames = {
                0: "GoingUp",
                1: "GoingDown",
                2: "GroundFloor",
                3: "Floor1",
                4: "Floor2",
                5: "Floor3",
                6: "Floor4",
                7: "Stopped",
                8: "Running",
                9: "Wait"
            };

            events.forEach(ev => {
                const li = document.createElement('li');
                const stateName = stateNames[ev.state]; // Obține numele stării
                li.textContent = `${stateName}`;
                list.appendChild(li);
            });
            if (events.length > 0) {
                const lastEvent = events[events.length - 1];
                const lastState = stateNames[lastEvent.state];
                setElevatorPosition(lastState);
            }
        }

        function toggleAutoReload() {
            const button = document.getElementById('reloadButton');
            if (isAutoReloadEnabled) {
                clearInterval(autoReloadInterval);
                button.textContent = "Pornește reîncărcarea automată";
                isAutoReloadEnabled = false;
            } else {
                startAutoReload();
                button.textContent = "Oprește reîncărcarea automată";
                isAutoReloadEnabled = true;
            }
        }

        let currentPosition = -2;

        function setElevatorPosition(state) {
            const circles = document.querySelectorAll('.circle');

            // Reacționăm doar la GoingUp și GoingDown
            if (state === 'GoingUp') {
                // Găsim primul cerc inactiv de jos în sus și îl activăm
                for (let i = circles.length - 1; i >= 0; i--) {
                    if (!circles[i].classList.contains('active')) {
                        circles[i].classList.add('active');
                        break;
                    }
                }
            }
            else if (state === 'GoingDown') {
                // Găsim primul cerc activ de sus în jos și îl dezactivăm
                for (let i = 0; i < circles.length; i++) {
                    if (circles[i].classList.contains('active')) {
                        circles[i].classList.remove('active');
                        break;
                    }
                }
            }
            // Pentru alte stări, nu facem nimic
        }


        function startAutoReload() {
            loadEvents(); // Încarcă imediat
            autoReloadInterval = setInterval(loadEvents, 1000); // Reîncarcă la fiecare secundă
        }

        // Pornește reîncărcarea automată la încărcarea paginii
        startAutoReload();







    </script>
</body>
</html>